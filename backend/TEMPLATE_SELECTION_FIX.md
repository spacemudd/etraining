# إصلاح مشكلة اختيار القالب المضغوط

## المشكلة
عند اختيار القالب المضغوط، كان يظهر القالب الافتراضي بدلاً من القالب المضغوط.

## السبب
كان المنطق في `CompanyAttendanceReportService.php` يعطي الأولوية للشركات المحددة مسبقاً قبل التحقق من اختيار المستخدم.

### المنطق القديم (المشكلة):
```php
// كان يتحقق من الشركات الخاصة أولاً
if (in_array($report->company->id, [...])) {
    $view = 'special-company-simple';
} elseif (in_array($report->company->id, [...])) {
    $view = 'special-company-modern';
} else {
    // ثم يتحقق من اختيار المستخدم
    switch ($report->template_type ?? 'default') {
        case 'mini': $view = 'special-company-mini'; break;
        // ...
    }
}
```

## الحل
تم تغيير المنطق ليعطي الأولوية لاختيار المستخدم أولاً، ثم يتحقق من الشركات الخاصة فقط في حالة القالب الافتراضي.

### المنطق الجديد (المصحح):
```php
// يتحقق من اختيار المستخدم أولاً
switch ($report->template_type ?? 'default') {
    case 'simple':
        $view = 'special-company-simple';
        break;
    case 'modern':
        $view = 'special-company-modern';
        break;
    case 'mini':
        $view = 'special-company-mini';
        break;
    default:
        // فقط في حالة القالب الافتراضي يتحقق من الشركات الخاصة
        if (in_array($report->company->id, [...])) {
            $view = 'special-company-simple';
        } elseif (in_array($report->company->id, [...])) {
            $view = 'special-company-modern';
        } else {
            $view = 'standard-template';
        }
        break;
}
```

## التحديثات المطبقة

### 1. دالة التقارير الجماعية (`makePdf`)
- ✅ إعادة ترتيب المنطق ليعطي الأولوية لاختيار المستخدم
- ✅ نقل منطق الشركات الخاصة إلى حالة `default` فقط

### 2. دالة التقارير الفردية (`makeIndividualPdf`)
- ✅ إعادة ترتيب المنطق ليعطي الأولوية لاختيار المستخدم
- ✅ نقل منطق الشركات الخاصة إلى حالة `default` فقط

## النتيجة
الآن عند اختيار أي قالب (بما في ذلك القالب المضغوط):
- ✅ **يتم استخدام القالب المختار** بغض النظر عن نوع الشركة
- ✅ **الشركات الخاصة** تستخدم قوالبها المحددة فقط عند اختيار "القالب الافتراضي"
- ✅ **المرونة الكاملة** للمستخدم في اختيار القالب المناسب

## الاختبار
- [x] اختيار القالب المضغوط يعمل بشكل صحيح
- [x] اختيار القالب الحديث يعمل بشكل صحيح  
- [x] اختيار القالب المبسط يعمل بشكل صحيح
- [x] القالب الافتراضي يعمل مع الشركات الخاصة

## الحالة: مكتمل ✅
تم إصلاح المشكلة بنجاح!
